# ADR-0001: Стратегия маршрутизации конструктора

Дата: 2025-09-20
Статус: Draft
Автор: Codex

## Контекст

- Проекту требуется единая навигационная схема для конструкторского режима, галереи шаблонов и настроек.
- Nuxt 3 автогенерирует маршруты из структуры каталога `app/pages`, что позволяет нормализовать поведение через соглашения об именовании.
- В дальнейшем ожидается поддержка нескольких проектов и предварительный просмотр шаблонов, поэтому маршрутизация должна масштабироваться без ломающих изменений.

## Решение

- Выделить три верхнеуровневых сегмента: `/builder`, `/templates`, `/settings`.
- Рабочая область конструктора живёт в группе `app/pages/builder/`:
  - `index.vue` — вход в текущий проект (по умолчанию открывает последний активный).
  - `[projectId]/index.vue` — редактирование конкретного проекта; параметр обязателен для шаринга ссылок.
  - `[projectId]/preview.vue` — полноэкранный предпросмотр (SSR/статический рендер).
- Галерея шаблонов располагается в `app/pages/templates/`:
  - `index.vue` — список категорий и поиск.
  - `[templateId]/index.vue` — детальный просмотр шаблона и запуск мастера.
- Настройки разделены по областям в `app/pages/settings/` с вложенными сегментами (`general`, `publishing`, `team`).
- Для повторно используемых оболочек вводим специализированные лайауты: `layouts/builder.vue` для рабочей области и `layouts/settings.vue` для настроек. По умолчанию страницы используют `default`.
- Переходы между сегментами выполняются без общего состояния роутера; важные параметры (`projectId`, `templateId`) передаются как динамические сегменты, вспомогательные фильтры — через query.

## Обоснование

- Автогенерация Nuxt снижает объём ручного кода и совпадает с ожидаемой структурой команды.
- Разделение на три сегмента отражает пользовательские сценарии и упрощает lazy-loading соответствующих бандлов.
- Динамические сегменты (`[projectId]`, `[templateId]`) поддерживают deep-linking и совместную работу.
- Выделенные лайауты позволяют подключать специфические панели (например, сайдбар редактора) без усложнения глобального лайаута.
- Альтернативы вроде единого маршрута `/app?mode=builder` завязаны на query-параметры, что ухудшает читаемость ссылок и усложняет линкинг.

## Последствия

- Необходимо создать директории `app/pages/templates/` и `app/pages/settings/` и подготовить базовые заглушки.
- Следует спланировать лайауты `builder` и `settings`, чтобы страницы автоматически получали нужные оболочки.
- Store должен управлять актуальным `projectId`, чтобы `index.vue` мог перенаправлять на конкретный проект.
- Документацию и дизайн-навигацию нужно синхронизировать с новой схемой.

## Связанные документы

- [План/задачи](../tasks/02-architecture.md)
- [Структура проекта](../plan.md)