# ADR-0002: Runtime config and environment variables

Дата: 2025-09-20
Статус: Adopted
Автор: Codex

## Контекст

- Проект использует Nuxt 3, который читает конфигурацию из `runtimeConfig` и переменных окружения `NUXT_*`.
- Нам нужны индивидуальные настройки для API конструктора, медиахранилища и клиентских интеграций (например, аналитика).
- Сейчас значения зашиты в коде или отсутствуют, что осложняет развёртывание на разных окружениях (local, staging, production).

## Решение

- Завести секцию `runtimeConfig` в `nuxt.config.ts` с явным перечнем ключей:
  - `apiBase` — приватная база URL бэкенда конструктора (используется серверными маршрутизаторами).
  - `mediaStorageBucket` — идентификатор бакета/контейнера, куда загружаются ассеты.
  - `public.apiBase` — публичная база URL API для клиентской части (по умолчанию `/api`).
  - `public.cdnBase` — базовый URL CDN для раздачи статических ассетов сайтов.
  - `public.analyticsKey` — ключ аналитики (например, PostHog/Amplitude) для условного подключения.
- Значения читаются из окружения: `NUXT_API_BASE`, `NUXT_MEDIA_STORAGE_BUCKET`, `NUXT_PUBLIC_API_BASE`, `NUXT_PUBLIC_CDN_BASE`, `NUXT_PUBLIC_ANALYTICS_KEY`.
- Создать файл `.env.example` с комментариями и дефолтами для локальной разработки.
- Документацию по переменным хранить в этом ADR; README ссылается на него.

## Обоснование

- Явное объявление ключей в `runtimeConfig` позволяет IDE и TypeScript корректно типизировать доступ к конфигурации.
- Разделение на приватную (`runtimeConfig.*`) и публичную (`runtimeConfig.public.*`) части соответствует безопасности Nuxt: приватные значения доступны только на сервере.
- Фиксированная схема переменных окружения упрощает настройку CI/CD и секретов.
- `.env.example` служит шаблоном для разработчиков и предотвращает случайные пропуски обязательных ключей.
- Альтернатива со статической конфигурацией в коде не масштабируется и не подходит для разных окружений.

## Последствия

- Нужно добавить `runtimeConfig` в `nuxt.config.ts` и удостовериться, что серверные/composable-слои используют новые ключи.
- Git игнорирует `.env`; разработчики копируют `.env.example` при настройке.
- При появлении новых интеграций ADR обновляется или дополняется новым документом.

## Связанные документы

- [План/задачи](../tasks/02-architecture.md)
- [Структура проекта](../plan.md)
- [Маршрутизация](./ADR-0001-routing-strategy.md)